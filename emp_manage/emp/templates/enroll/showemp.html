<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style type="text/css">
        .container {
            border-radius: 10px 10px 10px 10px;
            padding: 7% 10% 10px 10%;
        }
        
        #adding {
            padding: 1%;
        }
        
        .head {
            color: blue;
            align-items: center;
            text-align-last: center;
        }
        
        button {
            background-color: #56baed;
            border: none;
            color: white;
            padding: 4%;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            text-transform: uppercase;
            font-size: 64%;
            -webkit-box-shadow: 0 10px 30px 0 rgba(95, 186, 233, 0.4);
            box-shadow: 0 10px 30px 0 rgba(95, 186, 233, 0.4);
            -webkit-border-radius: 5px 5px 5px 5px;
            border-radius: 5px 5px 5px 5px;
            /* margin: 5px 20px 40px 20px; */
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -ms-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }
    </style>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <script type="text/javascript">
        var URL = "classproduct/";
        var csrftoken = $("[name=csrfmiddlewaretoken]").val();

        $(document).ready(function() {
            $("#adding").click(function() {
                location.href = "/create/";
            });
        });



        $(document).ready(function() {
            $("#updating").click(function() {
                location.href = "/update/";
            });
        });




        function getCourses() {
            $.getJSON(URL, {}, showCourses);
        }

        function getCourse() {
            $.getJSON(URL + $("#addressdetails").val())
                .done(showCourse) // on success - 200
                .fail(function() // on failure - 404
                    {
                        alert("Sorry! Course Not Found!");
                    }
                );
        }

        function showCourse(course) {
            $("#first_name").val(course.first_name)
            $("#last_name").val(course.last_name)
            $("#username").val(course.username)
            $("#date_of_birth").val(course.date_of_birth)
            $("#gender").val(course.gender)
            $("#email_address").val(course.email_address)
            $("#contact_number").val(course.contact_number)
            $("#addressdetails").val(course.addressdetails)
            $("#deleted").val(course.deleted)
        }

        function showCourses(courses) {
            $(document).ready(function() {
                $("#update").click(function() {
                    location.href = "/update/";
                });
            });

            $(document).ready(function() {
                $(document).on("click", ".editable", function() {
                    var value = $(this).text();
                    var input = "<input type='text' class='input-data' value='" + value + "' class='form-control'>";
                    $(this).html(input);
                    $(this).removeClass("editable")
                });

                $(document).on("blur", ".input-data", function(e) {
                    var value = $(this).val();
                    var td = $(this).parent("td");
                    $(this).remove();
                    td.html(value);
                    td.addClass("editable");
                    var type = td.data("type");
                    sendToserver(td.data("id"), value);
                });

                $(document).on("keypress", ".input-data", function(e) {
                    var key = e.which;
                    if (key == 13) {
                        var value = $(this).val();
                        var td = $(this).parent("td");
                        $(this).remove();
                        td.html(value);
                        td.addClass("editable");
                        var type = td.data("type");
                        sendToserver(td.data("id"), value);
                    }
                });

                function sendToserver(id, value, type) {
                    console.log(id);
                    console.log(value);
                    console.log(type);
                }

            });

            $(document).ready(function() {
                $("#refresh").click(function() {
                    location.reload();
                });
            });



            $("#courserows").html("");
            $.each(
                courses,
                function(idx, course) {
                    $("#courserows").append(

                        "<tr><td>{% if request.user.is_superuser %}<button onclick='updateCourse(" + course.id + ")'>Update</button><button id = 'refresh' onclick='deleteCourse(" + course.addressdetails + ")'>Delete</button>{% else %} {% endif %}</td><td class='editable' data-id=" + course.id + " data-type='first_name'>" +

                        course.first_name +
                        "</td><td class='editable' data-id=" + course.id + " data-type='last_name'>" +
                        course.last_name +
                        "</td><td class='editable' data-id=" + course.id + " data-type='username'>" +
                        course.username +
                        "</td><td class='editable' data-id=" + course.id + " data-type='date_of_birth'>" +
                        course.date_of_birth +
                        "</td><td class='editable' data-id=" + course.id + " data-type='gender'>" +
                        course.gender +
                        "</td><td class='editable' data-id=" + course.id + " data-type='email_address'>" +
                        course.email_address +
                        "</td><td class='editable' data-id=" + course.id + " data-type='contact_number'>" +
                        course.contact_number +
                        "</td><td class='editable' data-id=" + course.id + " data-type='deleted'>" +
                        course.deleted +
                        "</td><tr>"
                    );
                } // anonymous function
            );
            // each()

            $("table_id").show();
            $(document).ready(function() {
                $('#table_id').DataTable({
                    ajax: {
                        url: URL,
                        dataSrc: ""
                    },
                    columns: [{
                            data: 'action'
                        }, {
                            data: 'first_name'
                        }, {
                            data: 'last_name'
                        }, {
                            data: 'username'
                        }, {
                            data: 'date_of_birth'
                        }, {
                            data: 'gender'
                        }, {
                            data: 'email_address'
                        }, {
                            data: 'contact_number'
                        }, {
                            data: 'addressdetails'
                        }, {
                            data: 'deleted'
                        }


                    ],
                    "pageLength": 3,

                });

            })
        } // showCourses
        getCourses();


        function updateCourse(id) {
            console.log(id)
            $.ajax({
                "url": URL + id,
                "data": {
                    "first_name": $("#first_name").val(),
                    "last_name": $("#last_name").val(),
                    "username": $("#username").val(),
                    "date_of_birth": $("#date_of_birth").val(),
                    "gender": $("#gender").val(),
                    "email_address": $("#email_address").val(),
                    "contact_number": $("#contact_number").val(),

                    "deleted": $("#deleted").val()
                },
                "type": "put",
                "headers": {
                    "X-CSRFToken": '{{ csrf_token }}'
                },
                "success": update_success,
                "error": update_error

            }); // ajax()

        }

        function update_success() {
            alert("Updated Course Successfully");
        }

        function update_error() {
            alert("Could not update Course!");
        }

        function deleteCourse(id) {
            console.log(id)
            $.ajax({
                "url": URL + id,
                "type": "delete",
                "headers": {
                    "X-CSRFToken": '{{ csrf_token }}'
                },
                "success": delete_success,
                "error": delete_error
            }); // ajax()
        }

        function delete_success() {
            alert("Deleted Course Successfully");
        }

        function delete_error() {
            alert("Could not delete Course!");
        }
    </script>
</head>

<body>
    <div class="head">
        <h1>Employee Management System</h1>
    </div>
    <div class="container">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
        <table id="table_id" class="display">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>first_name</th>
                    <th>Last_Name</th>
                    <th>UserName</th>
                    <th>date_of_birth</th>
                    <th>gender</th>
                    <th>email_address</th>
                    <th>contact_number</th>
                    <th>Deleted</th>
                </tr>
            </thead>
            <tbody id="courserows"></tbody>
            </tbody>
        </table>
        <div>
            {% if request.user.is_superuser %}
            <button id="adding">ADD</button> {% else %} {% endif %}
            <span>
                <a class="hello-msg" href="{% url 'logout' %}">Logout</a>
            </span>
        </div>
    </div>
    <script></script>
</body>

</html>